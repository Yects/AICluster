# Use Alpine with Python 3.12
FROM python:3.12-alpine

# Set environment variables
ENV WORKING_PORT=8080
ENV DEBUG=1
ENV NODE_ID=exo-node-1

# Set working directory
WORKDIR /app

# Install dependencies
RUN apk add --no-cache \
    git \
    build-base \
    curl \
    bash && \
    rm -rf /var/cache/apk/*

# Install Python packages
RUN pip install --upgrade pip && \
    pip install --no-cache-dir requests

# Copy installation files
COPY setup.py .

# Install your application and dependencies
RUN pip install --no-cache-dir . && \
    pip install --no-cache-dir tensorflow && \
    pip cache purge

# Copy source code
COPY . .

# Set the entrypoint and command
ENTRYPOINT ["/usr/local/bin/python"]
CMD ["main.py", "--disable-tui", "--node-id", "$NODE_ID"]

# Expose the port
EXPOSE $WORKING_PORT
